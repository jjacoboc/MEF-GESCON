<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://java.sun.com/jsp/jstl/core">
    <style>
        .ui-fieldset .ui-fieldset-legend {
            padding-top: 4px;
            padding-bottom:  4px;
            padding-left:  5px;
            padding-right:  5px;
            font-size: 14px;
        }
    </style>
    <h:form id="fc">
        <p:growl id="growl" globalOnly="true" showDetail="true" sticky="true" />
        <p:panel styleClass="TexAlLeft containerView">
            <f:facet name="header">
                <h:outputText class="fa fa-file-text-o white Fs14" />
                <p:spacer width="5"/>
                <h:outputText value="#{baseLegalMB.selectedBaseLegal.vnumero}" />
            </f:facet>
            <h:panelGrid columns="1" width="100%">
                <h:panelGroup>
                    <h:outputText value="#{msgs.bl_lbl_conocimiento}" styleClass="Fs12" style="font-style: italic;"/>
                    <p:spacer width="5"/>
                    <h:outputText value="#{msgs.bl_lbl_pnlView}" styleClass="Fs12" style="font-style: italic;"/>
                    <p:spacer width="15"/>
                    <h:outputText value="#{msgs.bl_lbl_categoria}" styleClass="Fs12" style="font-style: italic;"/>
                    <p:spacer width="5"/>
                    <h:outputText value="#{baseLegalMB.selectedCategoria.vnombre}" styleClass="Fs12" style="font-style: italic;"/>
                    <p:spacer width="15"/>
                    <h:outputText value="#{msgs.bl_lbl_fecha}" styleClass="Fs12" style="font-style: italic;"/>
                    <p:spacer width="5"/>
                    <h:outputText value="#{baseLegalMB.selectedBaseLegal.dfechapublicacion}" styleClass="Fs12" style="font-style: italic;">
                        <f:convertDateTime dateStyle="medium" type="date" locale="es" />
                    </h:outputText>
                    <p:spacer width="15"/>
                    <h:outputText value="#{msgs.bl_lbl_rango}" styleClass="Fs12" style="font-style: italic;"/>
                    <p:spacer width="5"/>
                    <h:outputText value="#{baseLegalMB.selectedBaseLegal.nrangoid}" styleClass="Fs12" style="font-style: italic;" >
                        <f:converter converterId="converterRango"/>
                    </h:outputText>
                </h:panelGroup>
                <p:spacer/>
                <p:commandButton value="#{msgs.bl_btn_calificacion}" actionListener="#{baseLegalMB.toAddCalificacion}" update=":tabview:calDialogForm:pgCal" 
                                 oncomplete="PF('calDialog').show();" styleClass="ui-link Fs14" rendered="#{loginMB.user ne null}"/>
            </h:panelGrid>
            <h:panelGrid id="pgCal" columns="1" cellpadding="0" cellspacing="0" width="100%">
                <table class="Wid100">
                    <c:forEach items="#{baseLegalMB.listaCalificacion}" var="c" varStatus="vs">
                        <tr>
                            <td>
                                <h:panelGroup>
                                    <h:outputText value="#{c.usuarioNombre}" styleClass="Fs14 FontBold blue" />
                                    <p:spacer width="10"/>
                                    <h:outputText value=" [ " styleClass="FontBold black" rendered="#{loginMB.user ne null}"/>
                                    <p:commandLink value="editar" actionListener="#{baseLegalMB.toEditCalificacion}" update=":tabview:ecalDialogForm:pgEcal" 
                                                   oncomplete="PF('ecalDialog').show();" styleClass="ui-link Fs12" rendered="#{loginMB.user ne null}">
                                        <f:param name="index" value="#{vs.index}"/>
                                    </p:commandLink>
                                    <h:outputText value=" ]" styleClass="FontBold black" rendered="#{loginMB.user ne null}"/>
                                    <h:outputText value=" [ " styleClass="FontBold black" rendered="#{loginMB.user ne null}"/>
                                    <p:commandLink value="eliminar" actionListener="#{baseLegalMB.toDeleteCalificacion}" update=":tabview:ecalDialogForm:pgEcal" 
                                                   oncomplete="PF('confirmDlg').show();" styleClass="ui-link Fs12" rendered="#{loginMB.user ne null}">
                                        <f:param name="index" value="#{vs.index}"/>
                                    </p:commandLink>
                                    <h:outputText value=" ]" styleClass="FontBold black" rendered="#{loginMB.user ne null}"/>
                                </h:panelGroup>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <h:panelGrid columns="3" cellpadding="0" cellspacing="0">
                                    <p:rating value="#{c.ncalificacion}" readonly="true" />
                                    <p:spacer width="20"/>
                                    <h:outputText value="#{c.elapsedTime}" styleClass="Fs12" style="font-style: italic;"/>
                                </h:panelGrid>
                            </td>
                        </tr>
                        <tr style="border-bottom: gray solid 1px;"><td><h:outputText value="#{c.vcomentario}" escape="false" styleClass="Fs14"/></td></tr>
                        <tr><td><hr/></td></tr>
                    </c:forEach>
                </table>
            </h:panelGrid>
        </p:panel>
        <h:panelGrid columns="1" cellpadding="0" cellspacing="0" width="100%">
            <p:commandButton value="Regresar" ajax="false" action="#{consultaMB.back}"/>
        </h:panelGrid>
    </h:form>

    <p:dialog id="calDlg" header="#{msgs.bl_lbl_pnlCalificacion}" widgetVar="calDialog" modal="true" appendTo="@(body)" showEffect="fade" hideEffect="fade" resizable="false" closable="true">
        <h:form id="calDialogForm">
            <h:panelGrid id="pgCal" columns="1">
                <h:panelGroup>
                    <h:outputText value="#{msgs.icon_asterisk}"/>
                    <p:spacer width="5"/>
                    <h:outputText value="#{msgs.bl_lbl_calificacion}"/>
                </h:panelGroup>
                <p:rating value="#{baseLegalMB.calificacion}" />

                <h:panelGroup>
                    <h:outputText value="#{msgs.icon_asterisk}"/>
                    <p:spacer width="5"/>
                    <h:outputText value="#{msgs.bl_lbl_comentario}"/>
                </h:panelGroup>
                <h:panelGrid columns="1" cellspacing="0" cellpadding="0">
                    <p:inputTextarea value="#{baseLegalMB.comentarioCalificacion}" rows="5" cols="100" styleClass="Fs14"
                                     counter="display" maxlength="4000" counterTemplate="{0} caracteres restantes." />
                    <h:outputText id="display"/>
                </h:panelGrid>

                <p:commandButton value="#{msgs.bl_btn_addcalificacion}" actionListener="#{baseLegalMB.addCalificacion}" update=":tabview:fc:pgCal, :tabview:fc:growl" styleClass="ui-link Fs14"/>
            </h:panelGrid>
        </h:form>
    </p:dialog>

    <p:dialog id="ecalDlg" header="#{msgs.bl_lbl_pnlCalificacione}" widgetVar="ecalDialog" modal="true" appendTo="@(body)" showEffect="fade" hideEffect="fade" resizable="false" closable="true">
        <h:form id="ecalDialogForm">
            <h:panelGrid id="pgEcal" columns="1">
                <h:panelGroup>
                    <h:outputText value="#{msgs.icon_asterisk}"/>
                    <p:spacer width="5"/>
                    <h:outputText value="#{msgs.bl_lbl_calificacion}"/>
                </h:panelGroup>
                <p:rating value="#{baseLegalMB.selectedCalificacion.ncalificacion}" />

                <h:panelGroup>
                    <h:outputText value="#{msgs.icon_asterisk}"/>
                    <p:spacer width="5"/>
                    <h:outputText value="#{msgs.bl_lbl_comentario}"/>
                </h:panelGroup>
                <h:panelGrid columns="1" cellspacing="0" cellpadding="0">
                    <p:inputTextarea value="#{baseLegalMB.selectedCalificacion.vcomentario}" rows="5" cols="100" styleClass="Fs14"
                                     counter="display" maxlength="4000" counterTemplate="{0} caracteres restantes." />
                    <h:outputText id="display"/>
                </h:panelGrid>

                <p:commandButton value="#{msgs.bl_btn_editcalificacion}" actionListener="#{baseLegalMB.editCalificacion}" update=":tabview:fc:pgCal, :tabview:fc:growl" styleClass="ui-link Fs14"/>
            </h:panelGrid>
        </h:form>
    </p:dialog>

    <p:confirmDialog appendTo="@(body)" message="Se procederÃ¡ a eliminar el comentario. Desea Continuar?" header="ELIMINAR COMENTARIO" widgetVar="confirmDlg">
        <h:form id="confirmDlgForm">
            <p:commandButton value="SI" oncomplete="PF('confirmDlg').hide()" update=":tabview:fc:pgCal, :tabview:fc:growl" actionListener="#{baseLegalMB.deleteCalificacion}" styleClass="ui-confirmdialog-yes" icon="fa fa-check Fs14 white"/>
            <p:commandButton value="NO" onclick="PF('confirmDlg').hide()" styleClass="ui-confirmdialog-no" icon="ui-icon-close fa fa-close Fs14 white" />
        </h:form>
    </p:confirmDialog>
</ui:composition>